{% import 'utility.macros.j2' as utility %}
{% import 'birds/utility.macros.j2' as birds %}


{% macro list(project, named_states=[]) %}
<article class="project">

  {{ cover(project.cover_image) }}

  <header class="project-list-meta">
    <h2 class="project-list-title">{{ project.name }}</h2>

    {% if project.tagline %}
      <h3 class="project-list-tagline">{{ project.tagline }}
        {% if project.client %}
          {{ for(project.client, project.years) }}
        {% else %}
          {{ who(project.who) }}
        {% endif %}
      </h3>
    {% endif %}

    <div class="project-list-links">
      {% if project.url %}
        {{ utility.link_if('Case Study', project.url, class='btn') }}
      {% endif %}
      {% if project.source %}
        {{ utility.link_if('Source Code', project.source, class='btn') }}
      {% endif %}
    </div>
  </header>

  {% if project.description or project.status %}
    <p class="project-summary">
      {{ project.description }}

      {% if project.status %}
        <em>{{ named_states[project.status] or project.status }}</em>
      {% endif %}
    </p>
  {% endif %}

  {{ pullquote(project.quote) }}

</article>
{% endmacro %}


{% macro feature(project) %}
  <article>
    <h3>
      {{ utility.link_if(project.name, project.url) }}
    </h3>
    <h4>
      {{ project.tagline }}
    </h4>

    {% if project.client %}
      {{ for(project.client) }}
    {% else %}
      {{ who(project.who) }}
    {% endif %}

    {{ pullquote(project.quote) }}
  </article>
{% endmacro %}


{% macro pullquote(quote) %}
  {% if quote %}
    <blockquote>
      <p>“{{ quote.text }}”</p>
      <cite>—{{ quote.credit }}</cite>
    </blockquote>
  {% endif %}
{% endmacro %}


{% macro for(client, years) %}
  <span class="for-client">
    <i>for</i>
    {{ utility.link_if(
      client.name,
      client.url
    ) }}</span>
  <span class="for-years">
    {% if years %}
      [{{ years }}]
    {% endif %}
  </span>
{% endmacro %}


{% macro who(contributors) %}
  {% if contributors %}
    <ul>
      {% for contributor in contributors %}
        {% set page = all_pages|filter_pages('bird', 'eq', contributor.author)|get_page %}

        <li>
          {{ birds.name_link(
            author=contributor.author,
            page=page
          ) }}
          [{{ contributor.role }}]
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}



{% macro cover(cover_image) %}

  {% set coverimage = project.cover_image[0].src if project.cover_image %}
  {% set coverimage = coverimage if '://' in coverimage else [project.canonical_url, 'static/images/blog/', coverimage]|join('') %}

  {% if coverimage %}
    {% if '://' in coverimage %}
      <img src="{{ coverimage }}" class="cover10">
    {% else %}
      <img src="/static/images/blog/{{ coverimage }}" class="cover11">
    {% endif %}
  {% endif %}

{% endmacro %}
