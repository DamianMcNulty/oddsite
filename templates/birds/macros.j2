{% import "utility.macros.j2" as utility %}
{% import "blog/utility.macros.j2" as blog %}
{% import "birds/utility.macros.j2" as birds %}

{% macro section(page, oss=none) %}
  {% set author = page.config.bird %}

  <div data-module='bird' class="h-card" id="bird-{{ author }}">
    {{ utility.icon(author, size='face') }}

    <header>
      <h2 class="h-card">
        {{ birds.name_link(author) }}
      </h2>

      <div>
        {% set links = page.config.social[0] %}
        {% for link in links %}
          {{ birds.get_social(link, links[link]) }}
        {% endfor %}
      </div>
    </header>

    {{ page.render_contents() }}

    {{ oss_list(author, oss) }}
    {{ blog_list(
      posts=get_blog_entries_by_bird(author)|reverse|list
      ) }}
  </div>
{% endmacro %}


{% macro blog_list(posts) %}
  {% if posts|length %}
    <div>
      <h3>Recent Articles</h3>
      <ul>
        {% for post in posts %}
          {% if loop.index < 4 %}
            <li>
              {{ blog.link(post) }}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  {% endif %}
{% endmacro %}


{% macro oss_list(author, oss) %}
  {% if oss %}
    <div>
      <h3>Open Source</h3>
      <ul>
        {% for item in oss %}
          {% set oss_author = item.who|selectattr('author', 'equalto', author)|list %}

          {% if oss_author|length > 0 %}
            {% set oss_author = oss_author[0] %}

            <li>
              {{ utility.link_if(item.name, item.url or item.source) }}
              [{{ oss_author.role }}]
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  {% endif %}
{% endmacro %}
